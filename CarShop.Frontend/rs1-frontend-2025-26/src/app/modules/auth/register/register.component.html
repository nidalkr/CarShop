<div class="register-page" [ngClass]="{ 'register-page-compact': compact }">
  <div class="register-card">
    <!-- HEADER -->
    <div class="register-header">
      <div class="header-row">
        <div class="header-main">
          <h1 class="title">Create Account</h1>
          <p class="subtitle">
            {{ stepSubtitles[currentStep - 1] }}
          </p>
        </div>

        <div class="header-step">
          <div class="step-label">Step</div>
          <div class="step-counter">{{ currentStep }}/{{ totalSteps }}</div>

          <button type="button" class="header-close-btn" (click)="handleCloseClick()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <!-- PROGRESS BAR -->
      <div class="progress-wrapper">
        <div class="progress-track">
          <div class="progress-bar-inner" [style.width.%]="progressPercent"></div>
        </div>

        <!-- STEP CIRCLES -->
        <div class="step-indicators">
          <div *ngFor="let step of steps" class="step-indicator" [ngClass]="getStepCssClass(step)">
            <mat-icon *ngIf="step < currentStep">check</mat-icon>
            <span *ngIf="step >= currentStep">{{ step }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- BODY -->
    <div class="register-body">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <!-- STEP 1 -->
        <div *ngIf="currentStep === 1" class="wizard-step">
          <div class="row g-3">
            <div class="col-md-6">
              <div class="mb-2 form-group">
                <label class="form-label" for="firstName">First Name</label>
                <div class="input-wrapper" [class.invalid]="showError(firstName)">
                  <mat-icon>person_outline</mat-icon>
                  <input
                    id="firstName"
                    type="text"
                    class="form-control auth-input"
                    formControlName="firstName"
                    placeholder="John"
                    autocomplete="given-name"
                  />
                </div>
                <div class="invalid-feedback d-block" *ngIf="showError(firstName)">
                  First name is required.
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-2 form-group">
                <label class="form-label" for="lastName">Last Name</label>
                <div class="input-wrapper" [class.invalid]="showError(lastName)">
                  <mat-icon>person_outline</mat-icon>
                  <input
                    id="lastName"
                    type="text"
                    class="form-control auth-input"
                    formControlName="lastName"
                    placeholder="Doe"
                    autocomplete="family-name"
                  />
                </div>
                <div class="invalid-feedback d-block" *ngIf="showError(lastName)">
                  Last name is required.
                </div>
              </div>
            </div>
          </div>

          <div class="mt-3 form-group">
            <label class="form-label" for="username">Username</label>
            <div class="input-wrapper" [class.invalid]="showError(username)">
              <mat-icon>account_circle</mat-icon>
              <input
                id="username"
                type="text"
                class="form-control auth-input"
                formControlName="username"
                placeholder="johndoe123"
                autocomplete="username"
              />
            </div>
            <small class="helper-text-muted"> Choose a unique username (min. 3 characters). </small>
            <div class="invalid-feedback d-block" *ngIf="showError(username)">
              Username is required (min. 3 characters).
            </div>
          </div>

          <!-- actions -->
          <div class="wizard-actions single">
            <button type="button" class="btn primary-gradient-btn w-100" (click)="goToNext()">
              <span>Next Step</span>
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </div>

        <!-- STEP 2 -->
        <div *ngIf="currentStep === 2" class="wizard-step">
          <div class="mb-3 form-group">
            <label class="form-label" for="email">Email Address</label>
            <div class="input-wrapper" [class.invalid]="showError(email)">
              <mat-icon>mail_outline</mat-icon>
              <input
                id="email"
                type="email"
                class="form-control auth-input"
                formControlName="email"
                placeholder="your@email.com"
                autocomplete="email"
              />
            </div>
            <div class="invalid-feedback d-block" *ngIf="showError(email)">
              Enter a valid email address.
            </div>
          </div>

          <div class="mb-1 form-group">
            <label class="form-label" for="phone">Phone Number</label>
            <div class="input-wrapper" [class.invalid]="showError(phone)">
              <mat-icon>phone</mat-icon>
              <input
                id="phone"
                type="tel"
                class="form-control auth-input"
                formControlName="phone"
                placeholder="+1 (555) 123-4567"
                autocomplete="tel"
              />
            </div>
            <div class="invalid-feedback d-block" *ngIf="showError(phone)">
              Enter a valid phone number.
            </div>
          </div>

          <!-- actions -->
          <div class="wizard-actions">
            <button type="button" class="btn btn-ghost w-50" (click)="goToPrevious()">
              <mat-icon>arrow_back</mat-icon>
              <span>Previous</span>
            </button>

            <button type="button" class="btn primary-gradient-btn w-50" (click)="goToNext()">
              <span>Next Step</span>
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div *ngIf="currentStep === 3" class="wizard-step">
          <!-- error banner kao na slici -->
          <div
            *ngIf="showError(password) || form.hasError('passwordsMismatch')"
            class="error-banner"
            role="alert"
          >
            <mat-icon>error_outline</mat-icon>
            <span>{{ passwordErrorMessage }}</span>
          </div>

          <div class="mb-3 form-group mt-2">
            <label class="form-label" for="password">Password</label>

            <div class="input-wrapper" [class.invalid]="showError(password)">
              <mat-icon>lock_outline</mat-icon>
              <input id="password" type="password" class="form-control auth-input"
              formControlName="password" autocomplete="new-password" (input)="onPasswordInput()"            />
            </div>

            <!-- helper ispod inputa -->
            <small class="helper-text-muted">Min. 6 characters</small>

            <!-- error poruka (ako je imaÅ¡ veÄ‡ negdje, uskladi ovo s tim) -->
            <div class="text-danger small mt-1" *ngIf="showError(password)">
              {{ passwordErrorMessage }}
            </div>

            <!-- ðŸ”¥ PASSWORD STRENGTH METER -->
            <div class="password-strength mt-2" *ngIf="password?.value">
              <div class="password-strength__header">
                <span class="password-strength__label">Password strength</span>
                <span
                  class="password-strength__badge"
                  [ngClass]="'password-strength__badge--' + passwordStrengthClass"
                >
                  {{ passwordStrengthLabel }}
                </span>
              </div>

              <div class="password-strength__track">
                <div
                  class="password-strength__fill"
                  [ngClass]="'password-strength__fill--' + passwordStrengthClass"
                  [style.width.%]="passwordStrength"
                ></div>
              </div>

              <div class="password-strength__hint">
                Use at least 10 characters with a mix of letters, numbers and symbols.
              </div>
            </div>
          </div>

          <div class="mb-3 form-group">
            <label class="form-label" for="confirmPassword"> Confirm Password </label>
            <div
              class="input-wrapper"
              [class.invalid]="showError(confirmPassword) || form.hasError('passwordsMismatch')"
            >
              <mat-icon>lock_outline</mat-icon>
              <input
                id="confirmPassword"
                type="password"
                class="form-control auth-input"
                formControlName="confirmPassword"
                autocomplete="new-password"
              />
            </div>
            <div
              class="invalid-feedback d-block"
              *ngIf="form.hasError('passwordsMismatch') && (confirmPassword?.touched || submitted)"
            >
              Passwords do not match.
            </div>
          </div>

          <div class="mb-3 form-group">
            <label class="form-label" for="address">Address</label>
            <div class="input-wrapper textarea-wrapper" [class.invalid]="showError(address)">
              <mat-icon>location_on</mat-icon>
              <textarea
                id="address"
                rows="3"
                class="form-control auth-input"
                formControlName="address"
                placeholder="123 Main St, City, Country"
              ></textarea>
            </div>
            <div class="invalid-feedback d-block" *ngIf="showError(address)">
              Address is required.
            </div>
          </div>

          <!-- actions -->
          <div class="wizard-actions">
            <button type="button" class="btn btn-ghost w-50" (click)="goToPrevious()">
              <mat-icon>arrow_back</mat-icon>
              <span>Previous</span>
            </button>

            <button type="submit" class="btn primary-gradient-btn w-50" [disabled]="form.invalid">
              <mat-icon>check</mat-icon>
              <span>Create Account</span>
            </button>
          </div>
        </div>

        <!-- footer link -->
        <div class="wizard-footer">
          <span>Already have an account? </span>
          <button ype="button" class="link link-button" (click)="onSignInClick()">Sign in</button>
        </div>
      </form>
    </div>
  </div>
</div>
