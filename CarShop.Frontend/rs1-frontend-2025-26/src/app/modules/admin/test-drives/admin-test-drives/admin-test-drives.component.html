<!-- MOBILE FILTER BUTTON (samo na mobilnoj) -->
<div class="d-md-none mb-3 mobile-filter">
  <button
    type="button"
    class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2"
    data-bs-toggle="offcanvas"
    data-bs-target="#testDriveFilterOffcanvas"
    aria-controls="testDriveFilterOffcanvas">
    <i class="bi bi-funnel"></i>
    Filter
  </button>
</div>

<!-- DESKTOP STATUS FILTER BAR (samo na desktopu) -->
<div class="filter-bar card shadow-sm border-0 rounded-4 mb-4 d-none d-md-block">
  <div class="card-body py-3 px-3 px-md-4 d-flex align-items-center gap-3">

    <!-- filter icon -->
    <div class="filter-icon d-flex align-items-center justify-content-center rounded-3">
      <i class="bi bi-funnel"></i>
    </div>

    <!-- pills -->
    <div class="d-flex flex-wrap gap-2">
      <button
        type="button"
        class="btn filter-pill"
        [class.active]="selectedStatus === 'all'"
        (click)="selectedStatus = 'all'">
        All
      </button>

      <button
        type="button"
        class="btn filter-pill"
        [class.active]="selectedStatus === 'pending'"
        (click)="selectedStatus = 'pending'">
        Pending
      </button>

      <button
        type="button"
        class="btn filter-pill"
        [class.active]="selectedStatus === 'approved'"
        (click)="selectedStatus = 'approved'">
        Approved
      </button>

      <button
        type="button"
        class="btn filter-pill"
        [class.active]="selectedStatus === 'completed'"
        (click)="selectedStatus = 'completed'">
        Completed
      </button>
    </div>

  </div>
</div>

<!-- MOBILE OFFCANVAS FILTER -->
<div
  class="offcanvas offcanvas-bottom rounded-top-4"
  tabindex="-1"
  id="testDriveFilterOffcanvas"
  aria-labelledby="testDriveFilterOffcanvasLabel">

  <div class="offcanvas-header">
    <h5 class="offcanvas-title d-flex align-items-center gap-2" id="testDriveFilterOffcanvasLabel">
      <i class="bi bi-funnel"></i>
      Filter
    </h5>

    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body">
    <div class="d-flex flex-column gap-2">

      <button
        type="button"
        class="btn filter-pill w-100"
        [class.active]="selectedStatus === 'all'"
        (click)="selectedStatus = 'all'"
        data-bs-dismiss="offcanvas">
        All
      </button>

      <button
        type="button"
        class="btn filter-pill w-100"
        [class.active]="selectedStatus === 'pending'"
        (click)="selectedStatus = 'pending'"
        data-bs-dismiss="offcanvas">
        Pending
      </button>

      <button
        type="button"
        class="btn filter-pill w-100"
        [class.active]="selectedStatus === 'approved'"
        (click)="selectedStatus = 'approved'"
        data-bs-dismiss="offcanvas">
        Approved
      </button>

      <button
        type="button"
        class="btn filter-pill w-100"
        [class.active]="selectedStatus === 'completed'"
        (click)="selectedStatus = 'completed'"
        data-bs-dismiss="offcanvas">
        Completed
      </button>

    </div>
  </div>
</div>

<!-- TEST DRIVE CARDS -->
<div
  *ngFor="let td of filteredTestDrives"
  class="card mb-3 shadow-sm border-0 rounded-4 testdrive-card">

  <div class="card-body">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h6 class="mb-1">
          {{ td.customerName }}
          <span
            class="badge ms-2"
            [ngClass]="{
              'bg-warning text-dark': td.status === 'pending',
              'bg-primary': td.status === 'approved',
              'bg-success': td.status === 'completed',
              'bg-danger': td.status === 'rejected'
            }">
            {{ td.status }}
          </span>
        </h6>

        <small class="text-muted">
          Submitted: {{ td.submittedAt }}
        </small>
      </div>

      <i class="bi bi-eye text-secondary"></i>
    </div>

    <!-- CONTENT -->
    <div class="row">
      <div class="col-md-6">
        <small class="text-muted">Vehicle</small>
        <p class="fw-semibold mb-3">{{ td.vehicle }}</p>

        <small class="text-muted">Location</small>
        <p class="fw-semibold">{{ td.location }}</p>
      </div>

      <div class="col-md-6">
        <small class="text-muted">Date & Time</small>
        <p class="fw-semibold mb-3">{{ td.dateTime }}</p>

        <small class="text-muted">Contact</small>
        <p class="fw-semibold">{{ td.contact }}</p>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="border-top pt-3 mt-3 d-flex gap-2">

      <!-- APPROVE -->
      <button
        *ngIf="td.status === 'pending'"
        class="btn btn-success btn-sm d-flex align-items-center gap-1"
        (click)="approve(td)">
        <i class="bi bi-check-circle"></i>
        Approve
      </button>

      <!-- REJECT -->
      <button
        *ngIf="td.status === 'pending'"
        class="btn btn-danger btn-sm d-flex align-items-center gap-1"
        (click)="reject(td)">
        <i class="bi bi-x-circle"></i>
        Reject
      </button>

      <!-- MARK AS COMPLETED -->
      <button
        *ngIf="td.status === 'approved'"
        class="btn btn-primary btn-sm d-flex align-items-center gap-1"
        (click)="complete(td)">
        <i class="bi bi-check2-circle"></i>
        Mark as Completed
      </button>

    </div>

  </div>
</div>
